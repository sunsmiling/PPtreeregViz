<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Exploring projection pursuit regression tree with visualizing tools. 
  Showing various projection pursuit indexes and Explainable Artificial Intelligence methods can help to understand 
  the connection between input variables and model output.
  The implemented methods help to explore the model at the single instance level as well as the whole dataset level.
  Projection pursuit regression tree models are also compatible and supported in various explainable Artificial Intelligence packages developed in R.">
<title>Projection Pursuit Regression Tree Visualization  • PPtreeregViz</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Projection Pursuit Regression Tree Visualization ">
<meta property="og:description" content="Exploring projection pursuit regression tree with visualizing tools. 
  Showing various projection pursuit indexes and Explainable Artificial Intelligence methods can help to understand 
  the connection between input variables and model output.
  The implemented methods help to explore the model at the single instance level as well as the whole dataset level.
  Projection pursuit regression tree models are also compatible and supported in various explainable Artificial Intelligence packages developed in R.">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">PPtreeregViz</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="articles/PPtreeregViz.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/sunsmiling/PPtreeregViz/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level2">
<h2 id="pptreeregviz">PPtreeregViz<a class="anchor" aria-label="anchor" href="#pptreeregviz"></a>
</h2>
<!-- badges: start -->

<p>This package was developed to visualize the Projection Pursuit Regression Tree model <a href="https://www.mdpi.com/2076-3417/11/21/9885/pdf" class="external-link"></a> and add explanatory possibilities of the model using techniques. Since projection pursuit regression tree is based on tree method and grows using projection of input features, the model has excellent interpretability itself. By visualizing each node of this model, global analysis of the model is possible. (This method is model-specific because it can only be used in the model.) Global interpretation using this method is possible, but it is difficult to interpret one observation because it goes through several projections. To overcome this, the developed techniques were slightly modified to fit the structure of model. Using these visualization methods, it is possible to figure out how and what features have affected the model’s prediction. Through these processes, we can determine whether the model is trustworthy or not.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p><a href="https://github.com/sunsmiling/PPtreeregViz" class="external-link"><img src="reference/figures/logo.png" align="right" height="138.5"></a></p>
<p>You can install the released version of from CRAN with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"PPtreeregViz"</span><span class="op">)</span></span></code></pre></div>
<p>And the development version from GitHub with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"sunsmiling/PPtreeregViz"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-data">Example Data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<p>As an example, Boston house price data from the MASS library was used. In the first part, we will talk about visualizing model itself. Next, we will see an example of explaining model by applying techniques.</p>
<div class="section level3">
<h3 id="boston-data">Boston Data<a class="anchor" aria-label="anchor" href="#boston-data"></a>
</h3>
<p>The Boston data were divided into a train data set and a test data set at a ratio of 7:3. In particular, the first observation in the test data set was specifically selected as “sample_one”.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Boston"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">proportion</span> <span class="op">=</span> <span class="fl">0.7</span></span>
<span><span class="va">idx_train</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Boston</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">proportion</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Boston</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sample_train</span> <span class="op">=</span> <span class="va">Boston</span><span class="op">[</span><span class="va">idx_train</span>, <span class="op">]</span></span>
<span><span class="va">sample_test</span> <span class="op">=</span>  <span class="va">Boston</span><span class="op">[</span><span class="op">-</span><span class="va">idx_train</span>, <span class="op">]</span></span>
<span><span class="va">sample_one</span> <span class="op">&lt;-</span> <span class="va">sample_test</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sample_test</span><span class="op">)</span>,<span class="fl">1</span><span class="op">)</span>,<span class="op">-</span><span class="fl">14</span><span class="op">]</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="build-model--plot-model-itself">Build Model &amp; Plot Model itself<a class="anchor" aria-label="anchor" href="#build-model--plot-model-itself"></a>
</h2>
<p>Create a model with Depth as 2 for ease of visualization and interpretation.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sunsmiling/PPtreeregViz" class="external-link">PPtreeregViz</a></span><span class="op">)</span></span>
<span><span class="va">Model</span> <span class="op">&lt;-</span> <span class="fu">PPtreeregViz</span><span class="fu">::</span><span class="fu"><a href="reference/PPTreereg.html">PPTreereg</a></span><span class="op">(</span><span class="va">medv</span> <span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">sample_train</span>, DEPTH <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/plot.PPTreereg.html">plot</a></span><span class="op">(</span><span class="va">Model</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-4-1.png" width="80%"></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>Through <code>pp_ggparty</code>, marginal predicted values and actual values are drawn according to independent variables for each final node. In the group with the lower 25% of house prices, (lower status of the population (percent)) had a wide range from 10 to 30, but in the group with the top 25%, had only values less than 15.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/pp_ggparty.html">pp_ggparty</a></span><span class="op">(</span><span class="va">Model</span>, <span class="st">"lstat"</span>, final.rule <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-5-1.png" width="80%"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/pp_ggparty.html">pp_ggparty</a></span><span class="op">(</span><span class="va">Model</span>, <span class="st">"lstat"</span>, final.rule <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-6-1.png" width="80%"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/pp_ggparty.html">pp_ggparty</a></span><span class="op">(</span><span class="va">Model</span>, <span class="st">"lstat"</span>, final.rule <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-7-1.png" width="80%"></p>
<div class="section level3">
<h3 id="variable-importance-plot">variable importance plot<a class="anchor" aria-label="anchor" href="#variable-importance-plot"></a>
</h3>
<p>By using the combination of the regression coefficient values of the projection values at each split node, the importance of the variables for which the model was built can be calculated. <code>PPimportance</code> calculate split node’s coefficients and can be drawn for each final leaf. The blue bar represents the positive slope (effect), and the red bar represents the negative slope.</p>
<p>Variables are sorted according to the overall size of each bar, so you can know the variables that are considered important for each final node sequentially.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Tree.Imp</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/PPimportance.html">PPimportance</a></span><span class="op">(</span><span class="va">Model</span><span class="op">)</span> </span>
<span><span class="fu"><a href="reference/plot.PPTreereg.html">plot</a></span><span class="op">(</span><span class="va">Tree.Imp</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-8-1.png" width="80%"></p>
<p>If you use some arguments such as <code>marginal = TRUE</code> and <code>num_var</code>, you can see the desired number of marginal variable importance of the whole rather than each final leaf.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/plot.PPTreereg.html">plot</a></span><span class="op">(</span><span class="va">Tree.Imp</span>, marginal <span class="op">=</span> <span class="cn">TRUE</span>, num_var <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-9-1.png" width="80%"></p>
</div>
<div class="section level3">
<h3 id="node-visualization">Node visualization<a class="anchor" aria-label="anchor" href="#node-visualization"></a>
</h3>
<p><code>PPregNodeViz</code> can visualize how train data is fitted for each node. When the node.id is 4 (i.e. first final node), the result of fitted data is displayed in black color. In order to improve accuracy, can choose the final rule from 1 to 5, whether to use a single value or a linear combination of independent variables.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/PPregNodeViz.html">PPregNodeViz</a></span><span class="op">(</span><span class="va">Model</span>, node.id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-10-1.png" width="80%"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/PPregNodeViz.html">PPregNodeViz</a></span><span class="op">(</span><span class="va">Model</span>, node.id <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 2 rows containing missing values (`geom_point()`).</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-1.png" width="80%"></p>
<p>4th final leaf’s node id is 7.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/PPregNodeViz.html">PPregNodeViz</a></span><span class="op">(</span><span class="va">Model</span>,node.id <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 2 rows containing missing values (`geom_point()`).</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-12-1.png" width="80%"></p>
</div>
<div class="section level3">
<h3 id="variable-visualization">Variable visualization<a class="anchor" aria-label="anchor" href="#variable-visualization"></a>
</h3>
<p>Using <code>PPregvarViz</code> shows results similar to partial dependent plots of how independent variable affects the prediction of Y in actual data. If the argument <code>Indiv=TRUE</code>, the picture is drawn by dividing the grid for each final node.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/PPregVarViz.html">PPregVarViz</a></span><span class="op">(</span><span class="va">Model</span>,<span class="st">"lstat"</span><span class="op">)</span></span>
<span><span class="co">#&gt; `geom_smooth()` using method = 'loess' and formula = 'y ~ x'</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-13-1.png" width="80%"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/PPregVarViz.html">PPregVarViz</a></span><span class="op">(</span><span class="va">Model</span>,<span class="st">"lstat"</span>,indiv <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; `geom_smooth()` using method = 'loess' and formula = 'y ~ x'</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-14-1.png" width="80%"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/PPregVarViz.html">PPregVarViz</a></span><span class="op">(</span><span class="va">Model</span>,<span class="st">"chas"</span>,var.factor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-15-1.png" width="80%"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/PPregVarViz.html">PPregVarViz</a></span><span class="op">(</span><span class="va">Model</span>,<span class="st">"chas"</span>,indiv <span class="op">=</span> <span class="cn">TRUE</span>, var.factor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-16-1.png" width="80%"></p>
</div>
</div>
<div class="section level2">
<h2 id="using-method">Using method<a class="anchor" aria-label="anchor" href="#using-method"></a>
</h2>
<div class="section level3">
<h3 id="calculate-shap-for-method">Calculate SHAP for method<a class="anchor" aria-label="anchor" href="#calculate-shap-for-method"></a>
</h3>
<p>So far, we have only seen the global movement of the model itself. From now on, we will proceed with model analysis using SHAP values. Using the SHAP value, you can see locally how one sample data moves in the model. In order to calculate the SHAP value more faster, the method for calculating the kernel shap of the package was slightly modified and used.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_one</span></span>
<span><span class="co">#&gt;        crim zn indus chas  nox   rm  age    dis rad tax ptratio  black lstat</span></span>
<span><span class="co">#&gt; 177 0.07022  0  4.05    0 0.51 6.02 47.2 3.5549   5 296    16.6 393.23 10.11</span></span></code></pre></div>
<p>Since the <code>empirical</code> method, which is a more accurate calculation method, takes more time to calculate, a <code>simple</code> calculation method, which is an estimate of this value, was used.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/ppshapr.simple.html">ppshapr.simple</a></span><span class="op">(</span>PPTreeregOBJ <span class="op">=</span> <span class="va">Model</span>, testObs <span class="op">=</span> <span class="va">sample_one</span>, final.rule <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">$</span><span class="va">dt</span></span>
<span><span class="co">#&gt;        none         crim           zn       indus        chas           nox</span></span>
<span><span class="co">#&gt; 1: 23.25114 -0.008369025 -0.007357408 0.009685125 -0.00178154 -0.0002517925</span></span>
<span><span class="co">#&gt;              rm        age        dis          rad         tax     ptratio</span></span>
<span><span class="co">#&gt; 1: -0.008369025 0.06894799 0.04018246 -0.006113893 0.009685125 0.009685125</span></span>
<span><span class="co">#&gt;           black       lstat finalLeaf</span></span>
<span><span class="co">#&gt; 1: -0.003396076 -0.04969885         3</span></span></code></pre></div>
<p>Although the difference in calculation speed between and is quite large, it can be seen that the results are similar.</p>
</div>
<div class="section level3">
<h3 id="decision-plot">Decision plot<a class="anchor" aria-label="anchor" href="#decision-plot"></a>
</h3>
<p>creates a tree based on the range of y values. Therefore, when calculating the contributions of features of one observation, it is natural that different values are calculated for each final leaf. Compared with the data with y value in the lower 25% (first final leaf), the effect of of [<code>sample_one</code>] was very large. On the other hand, it can be seen that the influence of rm (average number of rooms per dwelling) is very large in data with upper 25% large y value (4th final leaf). How each feature affects y hat in one observation can be drawn in two ways. <code>decisionplot</code> and <code>waterfallplot</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/decisionplot.html">decisionplot</a></span><span class="op">(</span><span class="va">Model</span>, testObs <span class="op">=</span> <span class="va">sample_one</span>, method<span class="op">=</span><span class="st">"simple"</span>,varImp <span class="op">=</span> <span class="st">"shapImp"</span>,final.rule<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-19-1.png" width="80%"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/waterfallplot.html">waterfallplot</a></span><span class="op">(</span><span class="va">Model</span>, testObs <span class="op">=</span> <span class="va">sample_one</span>, method<span class="op">=</span><span class="st">"simple"</span>, final.rule<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-20-1.png" width="80%"></p>
</div>
<div class="section level3">
<h3 id="summary--dependence-plot">Summary &amp; Dependence plot<a class="anchor" aria-label="anchor" href="#summary--dependence-plot"></a>
</h3>
<p>We would like to see how the entire SHAP values of train data move in the model, not the effect of one observation. Since this could be quiet computationally expensive, so it is calculated at once using .</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shap_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ppshapr_prep.html">ppshapr_prep</a></span><span class="op">(</span><span class="va">Model</span>, final.rule <span class="op">=</span> <span class="fl">5</span>, method <span class="op">=</span> <span class="st">"simple"</span><span class="op">)</span> <span class="co">#takes about 4 minutes</span></span></code></pre></div>
<p>The summary plot visualizes how the overall features of the training data affect the SHAP distribution. For each final leaf, a red dot means that the feature value corresponding to that point has a high value. The yellow color means the middle value of the feature value, and the blue color has a lower feature value. For each leaf, features are sorted in descending order of the SHAP’s variance. In all final leaves, rm, , and tax had a great influence in determining the house price in common.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/PPshapsummary.html">PPshapsummary</a></span><span class="op">(</span>data_long <span class="op">=</span> <span class="va">shap_long</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-22-1.png" width="80%"></p>
<p>Through the dependency plot, for each final leaf, the effect of the number of rooms on the house price can be seen. When the number of rooms was 6 or less, the number of rooms did not have a significant effect on the house price in the low house price (first final leaf), but the SHAP value had a negative value as the number of rooms decreased in the data corresponding to the top 25% of the house price. In other words, it can be interpreted that in an area with a low house price, when the number of rooms was small or average, it did not affect house price, but in an area with a high house price, a small number of rooms had a negative effect on the house price.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/PPshapdependence.html">PPshapdependence</a></span><span class="op">(</span><span class="va">shap_long</span>,x <span class="op">=</span> <span class="st">"rm"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-23-1.png" width="80%"></p>
<p>You can add color to see how it relates to other feature. As a result of specifying as a color, it can be seen that the lower the and the larger the number of rooms, SHAP values increase.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/PPshapdependence.html">PPshapdependence</a></span><span class="op">(</span><span class="va">shap_long</span>, x <span class="op">=</span> <span class="st">"rm"</span>, color_feature <span class="op">=</span> <span class="st">"lstat"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-24-1.png" width="80%"></p>
<p>Next, as a result of examining and age, the higher contributed to the lower house price.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/PPshapdependence.html">PPshapdependence</a></span><span class="op">(</span><span class="va">shap_long</span>,x <span class="op">=</span> <span class="st">"crim"</span>, color_feature <span class="op">=</span> <span class="st">"age"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-25-1.png" width="80%"></p>
</div>
<div class="section level3">
<h3 id="collaboration-with-other-packages">Collaboration with other packages<a class="anchor" aria-label="anchor" href="#collaboration-with-other-packages"></a>
</h3>
<p>It can be collaborate with various that have already been developed ( and lime). If you use these package, you cannot see the characteristics of each final node, but you can see the results of the entire model. The following shows an example using the functions in the package.</p>
<div class="section level4">
<h4 id="section"></h4>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://modeloriented.github.io/DALEX/" class="external-link">"DALEX"</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Welcome to DALEX (version: 2.4.2).</span></span>
<span><span class="co">#&gt; Find examples and detailed introduction at: http://ema.drwhy.ai/</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 다음의 패키지를 부착합니다: 'DALEX'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     explain</span></span>
<span><span class="va">new_explainer</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/explain_PP.html">explain_PP</a></span><span class="op">(</span>PPTreeregOBJ <span class="op">=</span> <span class="va">Model</span>, data <span class="op">=</span> <span class="va">sample_train</span><span class="op">[</span>,<span class="op">-</span><span class="fl">14</span><span class="op">]</span>, </span>
<span>                            y <span class="op">=</span> <span class="va">sample_train</span><span class="op">[</span>,<span class="fl">14</span><span class="op">]</span>, final.rule <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; Preparation of a new explainer is initiated</span></span>
<span><span class="co">#&gt;   -&gt; model label       :  PPTreereg with final rule:  4 </span></span>
<span><span class="co">#&gt;   -&gt; data              :  354  rows  13  cols </span></span>
<span><span class="co">#&gt;   -&gt; target variable   :  354  values </span></span>
<span><span class="co">#&gt;   -&gt; predict function  :  function(m, x) as.numeric(predict.PPTreereg(m, x, final.rule = final.rule)) </span></span>
<span><span class="co">#&gt;   -&gt; predicted values  :  No value for predict function target column. (  default  )</span></span>
<span><span class="co">#&gt;   -&gt; model_info        :  package Model of class: PPTreereg package unrecognized , ver. Unknown , task regression (  default  ) </span></span>
<span><span class="co">#&gt;   -&gt; predicted values  :  numerical, min =  6.23836 , mean =  22.16265 , max =  50.86801  </span></span>
<span><span class="co">#&gt;   -&gt; residual function :  difference between y and yhat (  default  )</span></span>
<span><span class="co">#&gt;   -&gt; residuals         :  numerical, min =  -22.9165 , mean =  0.2167251 , max =  29.68961  </span></span>
<span><span class="co">#&gt;   A new explainer has been created!</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DALEX</span><span class="fu">::</span><span class="fu"><a href="https://modeloriented.github.io/DALEX/reference/model_performance.html" class="external-link">model_performance</a></span><span class="op">(</span><span class="va">new_explainer</span><span class="op">)</span></span>
<span><span class="co">#&gt; Measures for:  regression</span></span>
<span><span class="co">#&gt; mse        : 16.23654 </span></span>
<span><span class="co">#&gt; rmse       : 4.029459 </span></span>
<span><span class="co">#&gt; r2         : 0.8056848 </span></span>
<span><span class="co">#&gt; mad        : 1.566196</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;           0%          10%          20%          30%          40%          50% </span></span>
<span><span class="co">#&gt; -22.91649613  -3.46075535  -2.01332404  -1.09793019  -0.59868895  -0.09435965 </span></span>
<span><span class="co">#&gt;          60%          70%          80%          90%         100% </span></span>
<span><span class="co">#&gt;   0.57727933   1.21600562   2.26041174   4.14090308  29.68961335</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DALEX</span><span class="fu">::</span><span class="fu"><a href="https://modeloriented.github.io/DALEX/reference/model_performance.html" class="external-link">model_performance</a></span><span class="op">(</span><span class="va">new_explainer</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/plot.PPTreereg.html">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-28-1.png" width="80%"></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DALEX</span><span class="fu">::</span><span class="fu"><a href="https://modeloriented.github.io/DALEX/reference/model_profile.html" class="external-link">model_profile</a></span><span class="op">(</span><span class="va">new_explainer</span>, variables <span class="op">=</span> <span class="st">"rm"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/plot.PPTreereg.html">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-29-1.png" width="80%"></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DALEX</span><span class="fu">::</span><span class="fu"><a href="https://modeloriented.github.io/DALEX/reference/model_profile.html" class="external-link">model_profile</a></span><span class="op">(</span><span class="va">new_explainer</span>, variables <span class="op">=</span> <span class="st">"rm"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="reference/plot.PPTreereg.html">plot</a></span><span class="op">(</span>geom<span class="op">=</span><span class="st">"profiles"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-30-1.png" width="80%"></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DALEX</span><span class="fu">::</span><span class="fu"><a href="https://modeloriented.github.io/DALEX/reference/predict_parts.html" class="external-link">predict_parts</a></span><span class="op">(</span><span class="va">new_explainer</span>, new_observation <span class="op">=</span> <span class="va">sample_one</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="reference/plot.PPTreereg.html">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-31-1.png" width="80%"></p>
</div>
<div class="section level4">
<h4 id="lime-package">lime package<a class="anchor" aria-label="anchor" href="#lime-package"></a>
</h4>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PP_model</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span><span class="va">medv</span> <span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">sample_train</span>,</span>
<span>                         method <span class="op">=</span> <span class="va">PPTreereg.M5</span> ,</span>
<span>                         DEPTH<span class="op">=</span><span class="fl">2</span>,</span>
<span>                         PPmethod<span class="op">=</span><span class="st">"LDA"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 필요한 패키지를 로딩중입니다: lattice</span></span>
<span></span>
<span><span class="va">lime_explainer</span> <span class="op">&lt;-</span> <span class="fu">lime</span><span class="fu">::</span><span class="fu"><a href="https://lime.data-imaginist.com/reference/lime.html" class="external-link">lime</a></span><span class="op">(</span><span class="va">sample_train</span><span class="op">[</span>,<span class="op">-</span><span class="fl">14</span><span class="op">]</span>, <span class="va">PP_model</span><span class="op">)</span></span></code></pre></div>
<p>In order to check whether the created model works well, it is important to apply it to multiple instances. We implemented the algorithm in [‘LIME’]<a href="https://arxiv.org/abs/1602.04938" class="external-link"></a> , which presented the methodology for which instance to choose. It was possible to extract 10 data from the data set whose final leaf is 1.</p>
</div>
</div>
<div class="section level3">
<h3 id="section-1"></h3>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">class1s_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/SubPick_PPTreereg.html">SubPick_PPTreereg</a></span><span class="op">(</span><span class="va">Model</span>, <span class="va">lime_explainer</span>, <span class="st">"class1"</span>, obsnum <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> </span>
<span><span class="va">class1s_obs</span><span class="op">$</span><span class="va">obs</span> </span>
<span><span class="co">#&gt;  [1] "381" "455" "420" "452" "436" "451" "412" "432" "393" "143"</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/decisionplot.html">decisionplot</a></span><span class="op">(</span><span class="va">Model</span>, testObs <span class="op">=</span> <span class="va">class1s_obs</span><span class="op">$</span><span class="va">df</span> , method<span class="op">=</span><span class="st">"simple"</span>,varImp <span class="op">=</span> <span class="st">"shapImp"</span>,final.rule<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-34-1.png" width="80%"></p>
</div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/sunsmiling/PPtreeregViz/" class="external-link">Browse source code</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing PPtreeregViz</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Eun-Kyung Lee <br><small class="roles"> Author </small>  </li>
<li>HyunSun Cho <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/sunsmiling/PPtreeregViz/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/sunsmiling/PPtreeregViz/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#stable" class="external-link"><img src="https://img.shields.io/badge/lifecycle-stable-brightgreen.svg" alt="Lifecycle: stable"></a></li>
<li><a href="https://CRAN.R-project.org/package=PPtreeregViz" class="external-link"><img src="https://www.r-pkg.org/badges/version/PPtreeregViz" alt="CRAN status"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Eun-Kyung Lee, HyunSun Cho.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
